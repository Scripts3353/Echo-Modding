<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Space Bot Builder</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        background: radial-gradient(ellipse at center, #0d0d2b 0%, #1a1a40 100%);
        color: white;
        font-family: 'Segoe UI', sans-serif;
      }
      #blocklyDiv {
        height: 80vh;
        width: 100%;
        border: 4px solid #5a5af3;
        border-radius: 10px;
        margin: 20px auto;
      }
      h1 {
        text-align: center;
        padding-top: 20px;
        font-size: 2rem;
        color: #ffffff;
        text-shadow: 0 0 10px #0ff;
      }
      #output {
        background-color: #000000cc;
        border: 1px solid #5a5af3;
        color: #0ff;
        width: 90%;
        margin: 0 auto;
        padding: 10px;
        height: 200px;
        overflow-y: auto;
        border-radius: 8px;
        font-family: monospace;
      }
      .btn-generate {
        display: block;
        margin: 20px auto;
        background-color: #5a5af3;
        color: white;
        padding: 10px 20px;
        border-radius: 8px;
        font-size: 16px;
        border: none;
        cursor: pointer;
        transition: 0.3s;
      }
      .btn-generate:hover {
        background-color: #4646d2;
      }
    </style>
  </head>
  <body>
    <h1>ðŸš€ Space-Themed Bot Maker</h1>
    <div id="blocklyDiv"></div>
    <button class="btn-generate" onclick="generateCode()">ðŸ’¾ Generate Bot Code</button>
    <pre id="output">// Your bot code will appear here...</pre>

    <xml id="toolbox" style="display: none">
      <category name="Commands" colour="#5C81A6">
        <block type="bot_command"></block>
      </category>
      <category name="Responses" colour="#A65C81">
        <block type="bot_response"></block>
      </category>
      <category name="Logic" colour="#5CA65C">
        <block type="controls_if"></block>
      </category>
      <category name="Timing" colour="#A6A65C">
        <block type="wait_seconds"></block>
      </category>
    </xml>

    <script>
      // Define custom blocks
      Blockly.defineBlocksWithJsonArray([
        {
          type: "bot_command",
          message0: "when user uses /%1",
          args0: [
            {
              type: "field_input",
              name: "CMD",
              text: "hello"
            }
          ],
          nextStatement: null,
          colour: 230,
          tooltip: "Bot command trigger",
          helpUrl: ""
        },
        {
          type: "bot_response",
          message0: "respond with %1",
          args0: [
            {
              type: "field_input",
              name: "TEXT",
              text: "Hi there!"
            }
          ],
          previousStatement: null,
          nextStatement: null,
          colour: 160,
          tooltip: "Send a message",
          helpUrl: ""
        },
        {
          type: "wait_seconds",
          message0: "wait %1 seconds",
          args0: [
            {
              type: "field_number",
              name: "SECONDS",
              value: 1,
              min: 0,
              max: 10
            }
          ],
          previousStatement: null,
          nextStatement: null,
          colour: 60,
          tooltip: "Delay",
          helpUrl: ""
        }
      ]);

      // Inject Blockly
      const workspace = Blockly.inject("blocklyDiv", {
        toolbox: document.getElementById("toolbox"),
        theme: Blockly.Themes.Dark
      });

      // Generator stub
      const jsGenerator = Blockly.JavaScript;

      jsGenerator.forBlock["bot_command"] = function (block, generator) {
        const cmd = block.getFieldValue("CMD");
        const next = generator.statementToCode(block, "DO");
        return `bot.command("/${cmd}", async (ctx) => {\n${next}});\n`;
      };

      jsGenerator.forBlock["bot_response"] = function (block) {
        const text = block.getFieldValue("TEXT");
        return `  ctx.reply("${text}");\n`;
      };

      jsGenerator.forBlock["wait_seconds"] = function (block) {
        const secs = block.getFieldValue("SECONDS");
        return `  await new Promise(r => setTimeout(r, ${secs * 1000}));\n`;
      };

      function generateCode() {
        const code = jsGenerator.workspaceToCode(workspace);
        document.getElementById("output").textContent = code || "// No code generated.";
      }
    </script>
  </body>
</html>
