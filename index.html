<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ü™ê Space Bot Builder</title>
    <script src="https://unpkg.com/blockly/blockly.min.js"></script>
    <style>
      html, body {
        height: 100%;
        margin: 0;
        font-family: 'Orbitron', sans-serif;
        background: linear-gradient(to right, #0f0c29, #302b63, #24243e);
        color: white;
        overflow: hidden;
      }

      h1 {
        text-align: center;
        font-size: 2.5rem;
        color: #00ffff;
        padding: 20px;
        text-shadow: 0 0 10px #00ffff;
      }

      #blocklyDiv {
        height: 75vh;
        width: 95%;
        margin: auto;
        border: 2px solid #00ffff;
        border-radius: 10px;
        box-shadow: 0 0 20px #00ffff66;
      }

      .button-container {
        display: flex;
        justify-content: center;
        margin-top: 20px;
      }

      .btn-generate {
        background-color: #00ffff;
        border: none;
        color: #000;
        font-size: 1rem;
        padding: 10px 20px;
        border-radius: 8px;
        cursor: pointer;
        transition: 0.3s;
        box-shadow: 0 0 10px #00ffffaa;
      }

      .btn-generate:hover {
        background-color: #00d5d5;
      }

      #output {
        width: 95%;
        margin: 20px auto;
        height: 180px;
        background: #111;
        color: #0ff;
        border: 1px solid #00ffff;
        border-radius: 8px;
        padding: 10px;
        font-family: 'Courier New', monospace;
        overflow-y: auto;
        box-shadow: 0 0 10px #00ffff55 inset;
      }

      @import url('https://fonts.googleapis.com/css2?family=Orbitron&display=swap');
    </style>
  </head>

  <body>
    <h1>üöÄ Space Bot Builder</h1>

    <div id="blocklyDiv"></div>

    <div class="button-container">
      <button class="btn-generate" onclick="generateCode()">üíæ Generate Bot Code</button>
    </div>

    <pre id="output">// Your bot code will appear here...</pre>

    <xml id="toolbox" style="display: none">
      <category name="üöÄ Bot Commands" colour="#5CAEFF">
        <block type="bot_command"></block>
      </category>
      <category name="üí¨ Bot Actions" colour="#FF5CAD">
        <block type="bot_response"></block>
        <block type="wait_seconds"></block>
      </category>
      <category name="üîÅ Logic" colour="#FFD700">
        <block type="controls_if"></block>
      </category>
    </xml>

    <script>
      // Custom Blocks
      Blockly.defineBlocksWithJsonArray([
        {
          type: "bot_command",
          message0: "when user types /%1",
          args0: [{ type: "field_input", name: "CMD", text: "start" }],
          message1: "%1",
          args1: [{ type: "input_statement", name: "DO" }],
          colour: 230,
          tooltip: "Starts on command",
          helpUrl: ""
        },
        {
          type: "bot_response",
          message0: "send message %1",
          args0: [{ type: "field_input", name: "TEXT", text: "Hello, space traveler!" }],
          previousStatement: null,
          nextStatement: null,
          colour: 160,
          tooltip: "Send a reply",
          helpUrl: ""
        },
        {
          type: "wait_seconds",
          message0: "wait %1 seconds",
          args0: [{ type: "field_number", name: "SECONDS", value: 1, min: 0 }],
          previousStatement: null,
          nextStatement: null,
          colour: 60,
          tooltip: "Wait for seconds",
          helpUrl: ""
        }
      ]);

      const workspace = Blockly.inject("blocklyDiv", {
        toolbox: document.getElementById("toolbox"),
        theme: Blockly.Themes.Dark
      });

      const jsGen = Blockly.JavaScript;

      jsGen.forBlock["bot_command"] = function (block, generator) {
        const cmd = block.getFieldValue("CMD");
        const statements = generator.statementToCode(block, "DO");
        return `bot.command("/${cmd}", async (ctx) => {\n${statements}});\n`;
      };

      jsGen.forBlock["bot_response"] = function (block) {
        const msg = block.getFieldValue("TEXT");
        return `  ctx.reply("${msg}");\n`;
      };

      jsGen.forBlock["wait_seconds"] = function (block) {
        const sec = block.getFieldValue("SECONDS");
        return `  await new Promise(r => setTimeout(r, ${sec * 1000}));\n`;
      };

      function generateCode() {
        const code = jsGen.workspaceToCode(workspace);
        document.getElementById("output").textContent = code || "// No code generated.";
      }
    </script>
  </body>
</html>
